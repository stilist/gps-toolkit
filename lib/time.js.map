{"version":3,"sources":["../src/time.js"],"names":[],"mappings":";;;;;;;;AAAA;;;;AAEA;;;;;;;;;;;;;;IAcM,I;AACJ;;;;;AAKA,gBAAY,IAAZ,EAAkB;AAAA;;AAChB,QAAI,IAAJ,EAAU;AACR,UAAI,OAAO,SAAP,CAAiB,QAAjB,CAA0B,IAA1B,CAA+B,IAA/B,MAAyC,eAA7C,EAA8D;AAC5D,cAAM,IAAI,SAAJ,CAAc,6BAAd,CAAN;AACD;AACD,UAAI,OAAO,KAAK,KAAhB,EAAuB;AACrB,cAAM,IAAI,UAAJ,CAAe,iCAAiC,KAAK,KAAL,CAAW,YAAX,EAAhD,CAAN;AACD;AACF;;AAED,SAAK,IAAL,GAAY,QAAQ,IAAI,IAAJ,EAApB;AACD;;AAED;;;;;;;;wBAI0B;AACxB,UAAM,2BAA2B,KAAK,IAAL,CAAU,OAAV,KAAsB,KAAK,KAAL,CAAW,OAAX,EAAvD;AACA,aAAO,2BAA2B,IAAlC;AACD;;AAED;;;;;;;;;;;;;;;;;;;;;wBAkBmB;AACjB,UAAM,gBAAgB,IAAI,IAAJ,CAAS,KAAK,KAAL,CAAW,OAAX,KACC,KAAK,WAAL,GAAmB,KAAK,eAAxB,GAA0C,IADpD,CAAtB;;AAGA,aAAO,CAAC,KAAK,IAAL,CAAU,OAAV,KAAsB,cAAc,OAAd,EAAvB,IAAkD,IAAlD,GAAyD,KAAK,QAArE;AACD;;AAED;;;;;;;;;;;;;;wBAWkB;AAChB,aAAO,KAAK,KAAL,CAAW,KAAK,mBAAL,GAA2B,KAAK,eAA3C,CAAP;AACD;;AAED;;;;;;;;;;;;;;;;;;;;;;;;;;;wBAwBc;AACZ,aAAO,CAAC,KAAK,WAAL,IAAoB,EAArB,IAA2B,KAAK,YAAvC;AACD;;;;;AAEH;;;;;;;;;;;;AAUA,KAAK,SAAL,CAAe,KAAf,GAAuB,IAAI,IAAJ,CAAS,sBAAT,CAAvB;AACA;;;;;;;;AAQA,KAAK,SAAL,CAAe,eAAf,GAAiC,MAAjC,C,CAAwC;AACxC;;;;;;;;AAQA,KAAK,SAAL,CAAe,QAAf,GAA0B,GAA1B,C,CAA8B;;kBAEf,I","file":"time.js","sourcesContent":["import 'babel-polyfill'\n\n/**\n* [GPS specification]{@link http://www.gps.gov/technical/icwg/IS-GPS-200H.pdf}\n* (IS-GPS-200 revision H) § 3.3.4\n *\n * > GPS time [...] is referenced to Coordinated Universal Time (UTC) as\n * > maintained by the U.S. Naval Observatory (UTC (USNO)) zero time-point\n * > defined as midnight on the night of January 5, 1980/morning of January\n * > 6, 1980. The largest unit used in stating GPS time is one week defined as\n * > 604,800 seconds. GPS time may differ from UTC because GPS time shall be a\n * > continuous time scale, while UTC is corrected periodically with an integer\n * > number of leap seconds. There also is an inherent but bounded drift rate\n * > between the UTC and GPS time scales. The OCS shall control the GPS time\n * > scale to be within one microsecond of UTC (modulo one second).\n */\nclass Time {\n  /**\n   * @param {Date} [date=new Date()] - The date to use.\n   *\n   * @throws {(RangeError|TypeError)}\n   */\n  constructor(date) {\n    if (date) {\n      if (Object.prototype.toString.call(date) !== '[object Date]') {\n        throw new TypeError('date must be null or a Date')\n      }\n      if (date < this.epoch) {\n        throw new RangeError('date cannot be earlier than ' + this.epoch.toDateString())\n      }\n    }\n\n    this.date = date || new Date()\n  }\n\n  /**\n   * @access private\n   * @type {number}\n   */\n  get seconds_since_epoch() {\n    const milliseconds_since_epoch = this.date.getTime() - this.epoch.getTime()\n    return milliseconds_since_epoch / 1000\n  }\n\n  /**\n   * GPS specification § 3.3.4\n   *\n   * > [...] equal to the number of X1 epochs that have occurred since the\n   * > transition from the previous week. The count is short-cycled such that\n   * > the range of the TOW-count is from 0 to 403,199 X1 epochs (equaling one\n   * > week) and is reset to zero at the end of each week. The TOW-count's zero\n   * > state is defined as that X1 epoch which is coincident with the start of\n   * > the present week. This epoch occurs at (approximately) midnight Saturday\n   * > night-Sunday morning, where midnight is defined as 0000 hours on the UTC\n   * > scale which is nominally referenced to the Greenwich Meridian. Over the\n   * > years the occurrence of the \"zero state epoch\" may differ by a few\n   * > seconds from 0000 hours on the UTC scale since UTC is periodically\n   * > corrected with leap seconds while the TOW-count is continuous without\n   * > such correction.\n   *\n   * @type {number}\n   */\n  get time_of_week() {\n    const start_of_week = new Date(this.epoch.getTime() +\n                                   (this.week_number * this.seconds_in_week * 1000))\n\n    return (this.date.getTime() - start_of_week.getTime()) / 1000 / this.x1_epoch\n  }\n\n  /**\n   * GPS specification § 6.2.4\n   *\n   * > The GPS week numbering system is established with week number zero (0)\n   * > being defined as that week which started with the X1 epoch occurring at\n   * > midnight UTC (USNO) on the night of January 5, 1980/morning of January\n   * > 6, 1980. The GPS week number continuously increments by one (1) at each\n   * > end/start of week epoch without ever resetting to zero. [...]\n   *\n   * @type {number}\n   */\n  get week_number() {\n    return Math.floor(this.seconds_since_epoch / this.seconds_in_week)\n  }\n\n  /**\n   * GPS specification § 3.3.4\n   *\n   * > In each SV the X1 epochs of the P-code offer a convenient unit for\n   * > precisely counting and communicating time. Time stated in this manner is\n   * > referred to as Z-count, which is given as a binary number consisting of\n   * > two parts as follows:\n   * >\n   * > a. The binary number represented by the 19 least significant bits of the\n   * >   Z-count is referred to as the time of week (TOW) count and is defined\n   * >   as being equal to the number of X1 epochs that have occurred since the\n   * >   transition from the previous week. [...]\n   * >\n   * > b. The most significant bits of the Z-count are a binary representation\n   * >   of the sequential number assigned to the current GPS week (see\n   * >   paragraph 6.2.4).\n   *\n   * GPS specification § 20.3.3.2\n   *\n   * > [...] (The full TOW count consists of the 19 LSBs of\n   * > the 29-bit Z-count). [...]\n   *\n   * @type {number}\n   */\n  get z_count() {\n    return (this.week_number << 19) + this.time_of_week\n  }\n}\n/**\n * GPS specification § 3.3.4\n *\n * > GPS time [...] is referenced to Coordinated Universal Time (UTC) as\n * > maintained by the U.S. Naval Observatory (UTC (USNO)) zero time-point\n * > defined as midnight on the night of January 5, 1980/morning of January 6,\n * > 1980.\n *\n * @type {Date}\n */\nTime.prototype.epoch = new Date('1980-01-06T00:00:00Z')\n/**\n * GPS specification § 3.3.4\n *\n * > The largest unit used in stating GPS time is one week defined as 604,800\n * > seconds.\n *\n * @type {number}\n */\nTime.prototype.seconds_in_week = 604800 // seconds\n/**\n * GPS specification § 3.3.2.2\n *\n * > The X1 epoch occurs every 1.5 seconds after 15,345,000 chips of the X1\n * > pattern have been generated.\n *\n * @type {number}\n */\nTime.prototype.x1_epoch = 1.5 // seconds\n\nexport default Time\n"]}